@page "/books/{ISBN}"
@rendermode InteractiveServer
@using DTOs
@inject BlazorApp.Services.IBookService BookService

<h3>Book Details</h3>
@if (book == null)
{
    <p class="text-muted fst-italic">Loading book details...</p>
}
else
{
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">@book.Title</h4>
            <p class="card-text"><strong>Author:</strong> @book.Author</p>
            <p class="card-text"><strong>ISBN:</strong> @book.ISBN</p>
            <p class="card-text"><strong>Available Copies:</strong> @book.NoOfCopies</p>

            @if (book.NoOfCopies > 0)
            {
                <div class="alert alert-success" role="alert">
                    <i class="bi bi-check-circle"></i> This book is available for borrowing
                </div>
                <BorrowBook ISBN="@book.ISBN" OnBorrowSuccess="RefreshBookDetails" />
            }
            else
            {
                <div class="alert alert-warning" role="alert">
                    <i class="bi bi-exclamation-triangle"></i> All copies are currently borrowed
                </div>
                <ReserveBook ISBN="@book.ISBN" />
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public string ISBN { get; set; } = string.Empty;

    private BookDTO? book;

    protected override async Task OnInitializedAsync()
    {
        await LoadBookDetails();
    }

    private async Task LoadBookDetails()
    {
        try
        {
            book = await BookService.GetBookAsync(ISBN);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading book details: {ex.Message}");
        }
    }

    private async Task RefreshBookDetails()
    {
        await LoadBookDetails();
    }
}