@page "/books/{ISBN}"
@using DTOs.Book
@rendermode InteractiveServer
@inject Services.IBookService BookService

<div class="d-flex justify-content-center mt-5">
    <div class="card shadow-lg p-4" style="max-width: 600px; width: 100%;">
        @if (book == null)
        {
            <p class="text-muted fst-italic text-center fs-5">Loading book details...</p>
        }
        else
        {
            <div class="text-center">
                <h2 class="fw-bold mb-4 fs-1">@book.Title</h2>

                <p class="text-secondary mb-3 fs-5"><strong>Author:</strong> @book.Author</p>
                <p class="text-secondary mb-3 fs-5"><strong>ISBN:</strong> @book.ISBN</p>
                <p class="mb-4 fs-5">
                    <strong>Status:</strong>
                    @if (book.State.Equals("Available", StringComparison.OrdinalIgnoreCase))
                    {
                        <span class="text-success fw-bold">@book.State</span>
                    }
                    else
                    {
                        <span class="text-warning fw-bold">@book.State</span>
                    }
                </p>

                <div class="mt-4">
                    @if (book.State.Equals("Available", StringComparison.OrdinalIgnoreCase))
                    {
                        <BorrowBook ISBN="@book.ISBN" OnBorrowSuccess="RefreshBookDetails" />
                    }
                    else
                    {
                        <ReserveBook ISBN="@book.ISBN" />
                    }
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public string ISBN { get; set; } = string.Empty;

    private BookDTO? book;

    protected override async Task OnInitializedAsync()
    {
        await LoadBookDetails();
    }

    private async Task LoadBookDetails()
    {
        try
        {
            book = await BookService.GetBookAsync(ISBN);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading book details: {ex}");
        }
    }

    private async Task RefreshBookDetails()
    {
        await LoadBookDetails();
    }
}
